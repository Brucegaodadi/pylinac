<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>VMAT module documentation &mdash; Pylinac 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Pylinac 0.1.0 documentation" href="index.html" />
    <link rel="prev" title="Starshot module documentation" href="starshot_docs.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="starshot_docs.html" title="Starshot module documentation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Pylinac 0.1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="vmat-module-documentation">
<h1>VMAT module documentation<a class="headerlink" href="#vmat-module-documentation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-pylinac.vmatqa">
<span id="overview"></span><h2>Overview<a class="headerlink" href="#module-pylinac.vmatqa" title="Permalink to this headline">¶</a></h2>
<p>The VMAT module consists of the class VMAT, which is capable of loading an Open field image and MLC field image and analyzing the
images according to the Jorgensen et al. tests, specifically the dose-rate &amp; gantry-speed (DRGS) and MLC speed (MLCS) tests. The picket
fence tests are analyzed in another module.</p>
</div>
<div class="section" id="running-the-demo">
<h2>Running the Demo<a class="headerlink" href="#running-the-demo" title="Permalink to this headline">¶</a></h2>
<p>To run the VMAT demo, run vmat.py, or create a script and run:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylinac</span> <span class="kn">import</span> <span class="n">VMAT</span>
<span class="n">VMAT</span><span class="p">()</span><span class="o">.</span><span class="n">run_demo_drgs</span><span class="p">()</span>
<span class="c"># alternatively, you can run the MLC Speed demo by:</span>
<span class="n">VMAT</span><span class="p">()</span><span class="o">.</span><span class="n">run_demo_mlcs</span><span class="p">()</span>
</pre></div>
</div>
<p>Results will be printed to the console and a figure showing both the Open field and MLC field image will pop up.
#TODO: show screenshots of demo</p>
</div>
<div class="section" id="image-acquisition">
<h2>Image Acquisition<a class="headerlink" href="#image-acquisition" title="Permalink to this headline">¶</a></h2>
<p>If you want to perform these specific QA tests, you&#8217;ll need DICOM plan files that control the linac precisely to deliver the test fields.
These can be downloaded from my.varian.com, but conveniently, they are included in this package #TODO: add link to files.</p>
</div>
<div class="section" id="typical-use">
<h2>Typical Use<a class="headerlink" href="#typical-use" title="Permalink to this headline">¶</a></h2>
<p>The VMAT QA analysis follows what is specified in Jorgensen et al. and assumes your tests will run the exact same way. Let us assume
you&#8217;ve made a VMAT object as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylinac</span> <span class="kn">import</span> <span class="n">VMAT</span>
<span class="n">myvmat</span> <span class="o">=</span> <span class="n">VMAT</span><span class="p">()</span>
</pre></div>
</div>
<p>The minimum needed to get going is to:</p>
<ul>
<li><p class="first"><strong>Load images</strong> &#8211; Loading the EPID DICOM images into your VMAT class object can be done by passing the file path or by using a UI to
find and get each file. The code might look like either of the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># set the file path</span>
<span class="n">open_img</span> <span class="o">=</span> <span class="s">&quot;C:/QA Folder/VMAT/openfield.dcm&quot;</span>
<span class="n">mlc_img</span> <span class="o">=</span> <span class="s">&quot;C:/QA Folder/VMAT/mlcfield.dcm&quot;</span>
<span class="c"># load the images from the file path</span>
<span class="n">myvmat</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="n">open_img</span><span class="p">,</span> <span class="n">im_type</span><span class="o">=</span><span class="s">&#39;open&#39;</span><span class="p">)</span>
<span class="n">myvmat</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="n">mlc_img</span><span class="p">,</span> <span class="n">im_type</span><span class="o">=</span><span class="s">&#39;mlc&#39;</span><span class="p">)</span>

<span class="c"># *OR*</span>
<span class="c"># Identify the images using a UI</span>
<span class="n">myvmat</span><span class="o">.</span><span class="n">load_image_UI</span><span class="p">(</span><span class="n">im_type</span><span class="o">=</span><span class="s">&#39;open&#39;</span><span class="p">)</span>
<span class="n">myvmat</span><span class="o">.</span><span class="n">load_image_UI</span><span class="p">(</span><span class="n">im_type</span><span class="o">=</span><span class="s">&#39;mlc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Analyze the images</strong> &#8211; This is where pylinac does its work. Once everything is set up, tell VMAT to analyze the images. See the
Algorithm section for details on how this is done:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># analyze!</span>
<span class="n">myvmat</span><span class="o">.</span><span class="n">analyze</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>View the results</strong> &#8211; VMAT can print out the summary of results to the console as well as draw a matplotlib image to show where the
ROIs were taken and their values:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># print results to the console</span>
<span class="k">print</span><span class="p">(</span><span class="n">myvmat</span><span class="o">.</span><span class="n">get_string_results</span><span class="p">())</span>
<span class="c"># view analyzed images</span>
<span class="n">myvmat</span><span class="o">.</span><span class="n">show_img_results</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ul>
<p>For future reference, you can actually set the test and tolerance as arguments to the analyze method for even shorter code.</p>
</div>
<div class="section" id="algorithm">
<h2>Algorithm<a class="headerlink" href="#algorithm" title="Permalink to this headline">¶</a></h2>
<p>The VMAT analyze algorithm is based on an interpretation of Jorgensen et al.&#8217;s description and works like such:</p>
<p><strong>Allowances</strong></p>
<ul class="simple">
<li>The images can be acquired at any SID.</li>
</ul>
<p><strong>Assumptions</strong></p>
<ul class="simple">
<li>The tests were delivered using the DICOM RT plan files provided by Varian which follow the layout of Jorgensen et al.</li>
<li>The images were acquired with the EPID.</li>
</ul>
<p><strong>Pre-Analysis</strong></p>
<ul class="simple">
<li><em>Determine image scaling</em> &#8211; ROI determination is based on offsets from the center pixel of the image. However,
some physicists use 150 cm SID and others use 100 cm, and others can use a clinical setting that may be between the two. To account for
this, the SID is determined and then ROI scaling factors are determined to be able to produce properly-sized ROIs.</li>
</ul>
<p><strong>Analysis</strong></p>
<ul class="simple">
<li><em>Calculate sample boundaries &amp; extract</em> &#8211; Because the Jorgensen tests are always the
same in terms of where the radiation gets delivered, these values are hardcoded as offsets from the center pixel.
These values are then scaled with the image scaling factor determined above. The mean of the pixel values determined
by the boundaries is saved as the sample value.</li>
<li><em>Normalize images</em> &#8211; Once the sample values (and thus segments) are determined, both images are normalized.
Depending on the test, images are normalized by the 4th (DRGS) or mean of 2nd and 3rd (MLCS) segment for each image.</li>
<li><em>Calculate sample and segment ratios</em> &#8211; Once the images are normalized to themselves, the sample values of the MLC
field is divided by their corresponding open field values. These are the important values.</li>
<li><em>Calculate segment means and standard deviations</em> &#8211; Segment means are calculated from the samples comprising the
segment; standard deviations are determined the same way.</li>
</ul>
<p><strong>Post-Analysis</strong></p>
<ul class="simple">
<li><em>Test if samples pass tolerance</em> &#8211; For each sample, check if it was within the specified tolerance. If any samples
fail, the whole test is considered failing.</li>
</ul>
</div>
<div class="section" id="api-documentation">
<h2>API Documentation<a class="headerlink" href="#api-documentation" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="pylinac.vmatqa.vmat.VMAT">
<em class="property">class </em><tt class="descclassname">pylinac.vmatqa.vmat.</tt><tt class="descname">VMAT</tt><a class="reference internal" href="_modules/pylinac/vmatqa/vmat.html#VMAT"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pylinac.vmatqa.vmat.VMAT" title="Permalink to this definition">¶</a></dt>
<dd><p>The VMAT class analyzes two DICOM images acquired via a linac&#8217;s EPID and analyzes
regions of interest (segments) based on the paper by Jorgensen et al (<a class="reference external" href="http://dx.doi.org/10.1118/1.3552922">http://dx.doi.org/10.1118/1.3552922</a>), specifically,
the dose-rate gantry speed (DRGS) and MLC speed (MLCS) tests.</p>
<dl class="method">
<dt id="pylinac.vmatqa.vmat.VMAT.analyze">
<tt class="descname">analyze</tt><big>(</big><em>test</em>, <em>tolerance=3</em><big>)</big><a class="reference internal" href="_modules/pylinac/vmatqa/vmat.html#VMAT.analyze"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pylinac.vmatqa.vmat.VMAT.analyze" title="Permalink to this definition">¶</a></dt>
<dd><p>Analyze 2 VMAT images, the open field image and MLC field image, according to 1 of 2 possible tests.</p>
</dd></dl>

<dl class="method">
<dt id="pylinac.vmatqa.vmat.VMAT.get_string_results">
<tt class="descname">get_string_results</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/pylinac/vmatqa/vmat.html#VMAT.get_string_results"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pylinac.vmatqa.vmat.VMAT.get_string_results" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a string of the summary of the analysis results.</p>
</dd></dl>

<dl class="method">
<dt id="pylinac.vmatqa.vmat.VMAT.load_demo_image">
<tt class="descname">load_demo_image</tt><big>(</big><em>test_type='drgs'</em><big>)</big><a class="reference internal" href="_modules/pylinac/vmatqa/vmat.html#VMAT.load_demo_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pylinac.vmatqa.vmat.VMAT.load_demo_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the demo DICOM images from demo files folder</p>
</dd></dl>

<dl class="method">
<dt id="pylinac.vmatqa.vmat.VMAT.load_image">
<tt class="descname">load_image</tt><big>(</big><em>filepath</em>, <em>im_type='open'</em><big>)</big><a class="reference internal" href="_modules/pylinac/vmatqa/vmat.html#VMAT.load_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pylinac.vmatqa.vmat.VMAT.load_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the image directly by the file path (i.e. non-interactively).
:param filepath: The absolute path to the DICOM image
:type filepath: str
:param im_type: Specifies whether the image is the Open (&#8216;open&#8217;) or MLC (&#8216;mlc&#8217;) field.
:type im_type: str</p>
</dd></dl>

<dl class="method">
<dt id="pylinac.vmatqa.vmat.VMAT.load_image_UI">
<tt class="descname">load_image_UI</tt><big>(</big><em>im_type='open'</em><big>)</big><a class="reference internal" href="_modules/pylinac/vmatqa/vmat.html#VMAT.load_image_UI"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pylinac.vmatqa.vmat.VMAT.load_image_UI" title="Permalink to this definition">¶</a></dt>
<dd><p>Open a Qt UI file browser to load dicom image for given VMAT image.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>im_type</strong> (<em>str</em>) &#8211; &#8216;open&#8217; or &#8216;dmlc&#8217;; specifies which file/image is being loaded</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="pylinac.vmatqa.vmat.VMAT.open_Jorgensen_PDF">
<tt class="descname">open_Jorgensen_PDF</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/pylinac/vmatqa/vmat.html#VMAT.open_Jorgensen_PDF"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pylinac.vmatqa.vmat.VMAT.open_Jorgensen_PDF" title="Permalink to this definition">¶</a></dt>
<dd><p>Open the Jorgensen et al paper in PDF</p>
</dd></dl>

<dl class="method">
<dt id="pylinac.vmatqa.vmat.VMAT.run_demo_drgs">
<tt class="descname">run_demo_drgs</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/pylinac/vmatqa/vmat.html#VMAT.run_demo_drgs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pylinac.vmatqa.vmat.VMAT.run_demo_drgs" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the demo of the module for the Dose Rate &amp; Gantry Speed test.</p>
</dd></dl>

<dl class="method">
<dt id="pylinac.vmatqa.vmat.VMAT.run_demo_mlcs">
<tt class="descname">run_demo_mlcs</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/pylinac/vmatqa/vmat.html#VMAT.run_demo_mlcs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pylinac.vmatqa.vmat.VMAT.run_demo_mlcs" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the demo of the module for the MLC speed test.</p>
</dd></dl>

<dl class="method">
<dt id="pylinac.vmatqa.vmat.VMAT.show_img_results">
<tt class="descname">show_img_results</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/pylinac/vmatqa/vmat.html#VMAT.show_img_results"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pylinac.vmatqa.vmat.VMAT.show_img_results" title="Permalink to this definition">¶</a></dt>
<dd><p>Create 2 plots showing the open and MLC images with the samples and results drawn on.</p>
</dd></dl>

</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">VMAT module documentation</a><ul>
<li><a class="reference internal" href="#module-pylinac.vmatqa">Overview</a></li>
<li><a class="reference internal" href="#running-the-demo">Running the Demo</a></li>
<li><a class="reference internal" href="#image-acquisition">Image Acquisition</a></li>
<li><a class="reference internal" href="#typical-use">Typical Use</a></li>
<li><a class="reference internal" href="#algorithm">Algorithm</a></li>
<li><a class="reference internal" href="#api-documentation">API Documentation</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="starshot_docs.html"
                        title="previous chapter">Starshot module documentation</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/vmat_docs.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="starshot_docs.html" title="Starshot module documentation"
             >previous</a> |</li>
        <li><a href="index.html">Pylinac 0.1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, James Kerns.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>