<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Starshot module documentation &mdash; Pylinac 0.1.0a documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.0a',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Pylinac 0.1.0a documentation" href="index.html" />
    <link rel="prev" title="General Module Design" href="module_design.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="module_design.html" title="General Module Design"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Pylinac 0.1.0a documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="starshot-module-documentation">
<h1>Starshot module documentation<a class="headerlink" href="#starshot-module-documentation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-pylinac.starshot">
<span id="overview"></span><h2>Overview<a class="headerlink" href="#module-pylinac.starshot" title="Permalink to this headline">¶</a></h2>
<p>The Starshot module analyses a starshot film or multiple superimposed EPID images that measures the wobble of the
radiation spokes, whether gantry, collimator, or couch.</p>
</div>
<div class="section" id="running-the-demo">
<h2>Running the Demo<a class="headerlink" href="#running-the-demo" title="Permalink to this headline">¶</a></h2>
<p>To run the Starshot demo, run starshot.py, or create a script and run:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylinac</span> <span class="kn">import</span> <span class="n">Starshot</span>
<span class="n">Starshot</span><span class="p">()</span><span class="o">.</span><span class="n">run_demo</span><span class="p">()</span>
</pre></div>
</div>
<p>Results will be printed to the console and a figure showing the analyzed starshot image will pop up.
#TODO: show screenshots of demo</p>
</div>
<div class="section" id="image-acquisition">
<h2>Image Acquisition<a class="headerlink" href="#image-acquisition" title="Permalink to this headline">¶</a></h2>
<p>To capture starshot images, film is often used, but superimposed EPID images can also work for collimator measurements.
See #TODO: fill in literature of starshots</p>
</div>
<div class="section" id="typical-use">
<h2>Typical Use<a class="headerlink" href="#typical-use" title="Permalink to this headline">¶</a></h2>
<p>The Starshot analysis follows methods from what is specified in Jorgensen et al. and assumes your tests will run the exact same way. Let us assume
you&#8217;ve made a VMAT object as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylinac</span> <span class="kn">import</span> <span class="n">Starshot</span>
<span class="n">mystar</span> <span class="o">=</span> <span class="n">Starshot</span><span class="p">()</span>
</pre></div>
</div>
<p>The minimum needed to get going is to:</p>
<ul>
<li><p class="first"><strong>Load images</strong> &#8211; Loading film or superimposed EPID DICOM images into your Starshot class object can be done by
passing the file path or by using a UI to find and get the file. The code might look like either of the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># set the file path</span>
<span class="n">star_img</span> <span class="o">=</span> <span class="s">&quot;C:/QA Folder/stars/gantry_starshot.tif&quot;</span>
<span class="c"># load the images from the file path</span>
<span class="n">mystar</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="n">star_img</span><span class="p">)</span>

<span class="c"># *OR*</span>
<span class="c"># Identify the image using a UI</span>
<span class="n">mystar</span><span class="o">.</span><span class="n">load_image_UI</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Analyze the images</strong> &#8211; After loading the image, all that needs to be done is analyze the image with a few
settings passed in:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># analyze!</span>
<span class="n">mystar</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">allow_inversion</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>View the results</strong> &#8211; VMAT can print out the summary of results to the console as well as draw a matplotlib image to show where the
ROIs were taken and their values:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># print results to the console</span>
<span class="k">print</span><span class="p">(</span><span class="n">myvmat</span><span class="o">.</span><span class="n">get_string_results</span><span class="p">())</span>
<span class="c"># view analyzed images</span>
<span class="n">myvmat</span><span class="o">.</span><span class="n">show_img_results</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ul>
<p>For future reference, you can actually set the test and tolerance as arguments to the analyze method for even shorter code.</p>
</div>
<div class="section" id="algorithm">
<h2>Algorithm<a class="headerlink" href="#algorithm" title="Permalink to this headline">¶</a></h2>
<p><strong>Allowances</strong></p>
<ul class="simple">
<li>The image can be either inversion</li>
<li>The image can be any size</li>
</ul>
<p><strong>Restrictions</strong></p>
<ul class="simple">
<li>The center of the &#8220;star&#8221; must be near an edge of the image.</li>
<li>If using superimposed images, the images must be the same size.</li>
<li>The radiation spokes must extend to both sides of the center. I.e. the spokes must not end at the center of the circle.</li>
<li>The spokes must have an adjacent spacing of at least 3 degrees.</li>
</ul>
<p><strong>Pre-Analysis</strong></p>
<ul class="simple">
<li><em>Check image inversion</em> &#8211; The image is checked for proper inversion by summing the image along each axis and then
finding the point of maximum value. If the point is not in the central 1/3 of the image, it is thought to be inverted.
This check can be skipped but is enabled by default.</li>
<li><em>Set mechanical isocenter</em> &#8211; Unless the user has manually set the pixel location of the mechanical isocenter (the
starting point of the algorithm) it is automatically found by summing the image along each axis and finding the
center of the full-width, 80%-max of each sum.</li>
</ul>
<p><strong>Analysis</strong></p>
<ul class="simple">
<li><em>Extract circle profile</em> &#8211; A circular profile is extracted from the image centered around the mechanical isocenter
and at the radius given.</li>
<li><em>Find spoke centers</em> &#8211; The circle profile is analyzed for peaks. Once the peaks are found, the pixels around the peak
are reanalyzed to find the center of the full-width, half-max. An even number of spokes must be found (1 for each
side. E.g. 3 collimator angles should produce 6 spokes, one for each side of the CAX).</li>
<li><em>Match peaks</em> &#8211; Peaks are matched to their counterparts opposite the CAX to compose a line.</li>
<li><em>Find wobble</em> &#8211; Starting at the mechanical isocenter point, an evolutionary gradient method is utilized like this:
for a 3x3 matrix around a starting point, the sum of distances to each line is calculated. If the center matrix value
is not the lowest value (within a tolerance), the calculation is performed again, starting at the point of lowest value of the previous
calculation. Thusly, the algorithm moves 1 pixel at a time toward a point of minimum distance to all lines. Once the
nearest pixel is found, the algorithm switches to sub-pixel precision and repeats.</li>
</ul>
<p><strong>Post-Analysis</strong></p>
<ul class="simple">
<li><em>Check if passed</em> &#8211; Once the wobble is calculated, it is tested against the tolerance given, and passes if below the
tolerance.</li>
</ul>
</div>
<div class="section" id="api-documentation">
<h2>API Documentation<a class="headerlink" href="#api-documentation" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="pylinac.starshot.starshot.Starshot">
<em class="property">class </em><tt class="descclassname">pylinac.starshot.starshot.</tt><tt class="descname">Starshot</tt><a class="reference internal" href="_modules/pylinac/starshot/starshot.html#Starshot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pylinac.starshot.starshot.Starshot" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a Starshot instance for determining the wobble in a gantry, collimator,
couch or MLC starshot image pattern.</p>
<dl class="method">
<dt id="pylinac.starshot.starshot.Starshot.analyze">
<tt class="descname">analyze</tt><big>(</big><em>allow_inversion=True</em>, <em>radius=50</em><big>)</big><a class="reference internal" href="_modules/pylinac/starshot/starshot.html#Starshot.analyze"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pylinac.starshot.starshot.Starshot.analyze" title="Permalink to this definition">¶</a></dt>
<dd><p>Analyze the starshot image.
Analyze finds the minimum radius and center of a circle that touches all the lines
(i.e. the wobble circle diameter and wobble center)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>allow_inversion</strong> (<em>boolean</em>) &#8211; Specifies whether to let the algorithm automatically check the image for proper inversion. Analysis will
likely fail without proper inversion. Use .invert_image() to manually invert.</li>
<li><strong>radius</strong> (<em>int, float</em>) &#8211; Distance in % between starting isocenter (mech point) and closest image edge.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="pylinac.starshot.starshot.Starshot.clear_mech_point">
<tt class="descname">clear_mech_point</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/pylinac/starshot/starshot.html#Starshot.clear_mech_point"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pylinac.starshot.starshot.Starshot.clear_mech_point" title="Permalink to this definition">¶</a></dt>
<dd><p>Clear/reset the mechanical iso.</p>
</dd></dl>

<dl class="method">
<dt id="pylinac.starshot.starshot.Starshot.load_demo_image">
<tt class="descname">load_demo_image</tt><big>(</big><em>number=1</em><big>)</big><a class="reference internal" href="_modules/pylinac/starshot/starshot.html#Starshot.load_demo_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pylinac.starshot.starshot.Starshot.load_demo_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Load a starshot demo image.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>number</strong> (<em>int</em>) &#8211; There are a few demo images. This number will choose which demo file to use. As of now
there are 2 demo images.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="pylinac.starshot.starshot.Starshot.plot_analyzed_image">
<tt class="descname">plot_analyzed_image</tt><big>(</big><em>plot=None</em><big>)</big><a class="reference internal" href="_modules/pylinac/starshot/starshot.html#Starshot.plot_analyzed_image"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pylinac.starshot.starshot.Starshot.plot_analyzed_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Draw the star lines, profile circle, and wobble circle on a matplotlib figure.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>plot</strong> (<em>matplotlib.image.AxesImage</em>) &#8211; The plot to draw on. If None, will create a new one.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="pylinac.starshot.starshot.Starshot.return_string_results">
<tt class="descname">return_string_results</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/pylinac/starshot/starshot.html#Starshot.return_string_results"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pylinac.starshot.starshot.Starshot.return_string_results" title="Permalink to this definition">¶</a></dt>
<dd><p>Print the results of the analysis.
:return string: A string with a statement of the minimum circle.</p>
</dd></dl>

<dl class="method">
<dt id="pylinac.starshot.starshot.Starshot.run_demo">
<tt class="descname">run_demo</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/pylinac/starshot/starshot.html#Starshot.run_demo"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pylinac.starshot.starshot.Starshot.run_demo" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the Starshot module demo.</p>
</dd></dl>

<dl class="method">
<dt id="pylinac.starshot.starshot.Starshot.set_mech_point">
<tt class="descname">set_mech_point</tt><big>(</big><em>point</em>, <em>warn_if_far_away=True</em><big>)</big><a class="reference internal" href="_modules/pylinac/starshot/starshot.html#Starshot.set_mech_point"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pylinac.starshot.starshot.Starshot.set_mech_point" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the mechanical isocenter (i.e. starting point) point manually.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>point</strong> (<em>list</em>) &#8211; [y,x]</li>
<li><strong>warn_if_far_away</strong> (<em>boolean</em>) &#8211; If the point is far away from the automatic determination, warn user</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Starshot module documentation</a><ul>
<li><a class="reference internal" href="#module-pylinac.starshot">Overview</a></li>
<li><a class="reference internal" href="#running-the-demo">Running the Demo</a></li>
<li><a class="reference internal" href="#image-acquisition">Image Acquisition</a></li>
<li><a class="reference internal" href="#typical-use">Typical Use</a></li>
<li><a class="reference internal" href="#algorithm">Algorithm</a></li>
<li><a class="reference internal" href="#api-documentation">API Documentation</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="module_design.html"
                        title="previous chapter">General Module Design</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/starshot_docs.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="module_design.html" title="General Module Design"
             >previous</a> |</li>
        <li><a href="index.html">Pylinac 0.1.0a documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, James Kerns.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>